(()=>{"use strict";var e="popup_opened";function t(t){if("Escape"===t.key){var n=document.querySelector(".".concat(e));r(n)}}var n,o,r=function(n){n.classList.remove(e),document.body.removeEventListener("keydown",t)},c=function(n){n.classList.add(e),document.body.addEventListener("keydown",t)},a={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"3701fab1-1ed4-4420-a3e5-6e9ed2eab0d1","Content-Type":"application/json"}},u={name:"",about:"",avatar:"",_id:"",cohort:""},i=function(e){u=e},s=function(e){return u._id===e._id},l="place__like-button_active",d=document.querySelector(".popup_content_image"),p=d.querySelector(".popup__image-caption"),f=d.querySelector(".popup__image"),_=document.querySelector("#create_place"),m=function(e,t){var n=function(e){var t=_.content.querySelector(".place").cloneNode(!0);t.querySelector(".place__name").textContent=e.name;var n=t.querySelector(".place__image");n.src=e.link,n.alt=e.name,n.addEventListener("click",(function(){!function(e,t,n){t.src=e.src,t.alt=e.alt,p.textContent=e.alt,c(n)}(n,f,d)}));var o=t.querySelector(".place__remove-button");s(e.owner)&&o.classList.add("place__remove-button_visible"),o.addEventListener("click",(function(){var n;(n=e._id,fetch("".concat(a.baseUrl,"/cards/").concat(n),{headers:a.headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e),function(e){e.remove()}(t)})).catch((function(e){console.log(e)}))}));var r=t.querySelector(".place__like-button");e.likes.some((function(e){return s(e)}))&&r.classList.add(l);var u=t.querySelector(".place__like-count");return u.textContent=e.likes.length,r.addEventListener("click",(function(){var t=r.classList.contains(l);(function(e,t){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e),{headers:a.headers,method:t?"DELETE":"PUT"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(e._id,t).then((function(e){!function(e){e.classList.toggle(l)}(r),u.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),t}(e);t.prepend(n)},v=function(e,t,n,o){e.classList.remove(n),e.textContent="",t.classList.remove(o)},h=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))},y=function(e,t,n,o,r,c){t.forEach((function(t){var n=e.querySelector(".".concat(t.id,"-error"));v(n,t,o,r)})),setTimeout((function(){h(t,n,c)}),0)},S=document.querySelector(".popup_content_profile"),b=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),C=document.querySelector(".profile__avatar"),E=S.querySelector(".popup__input_data_name"),L=S.querySelector(".popup__input_data_description"),k=document.querySelector(".profile__edit-button"),g=document.querySelector(".popup_content_place"),x=g.querySelector(".popup__input_data_name"),j=g.querySelector(".popup__input_data_description"),P=document.querySelector(".profile__add-button"),A=document.querySelector(".profile__avatar-container"),U=document.querySelector(".popup_content_avatar"),T=U.querySelector(".popup__input_data_description"),w=document.forms.newPlace,B=document.forms.profileEdit,N=document.forms.avatarEdit,O=".popup__save-button",D=document.querySelector(".places__list");n="popup",document.querySelectorAll(".".concat(n)).forEach((function(e){return e.addEventListener("mousedown",(function(t){(t.target.classList.contains(n)||t.target.classList.contains("popup__close-button"))&&r(e)}))})),o={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(o.formSelector)).forEach((function(e){var t=Array.from(e.querySelectorAll(o.inputSelector)),n=e.querySelector(o.submitButtonSelector);!function(e,t,n,o,r,c){t.addEventListener("submit",(function(e){e.preventDefault()})),t.addEventListener("reset",(function(a){y(t,e,n,o,r,c)})),e.forEach((function(a){a.addEventListener("input",(function(){!function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?v(r,t,n,o):function(e,t,n,o,r){e.textContent=n,e.classList.add(o),t.classList.add(r)}(r,t,t.validationMessage,n,o)}(t,a,o,r),h(e,n,c)}))})),h(e,n,c)}(t,e,n,o.errorClass,o.inputErrorClass,o.inactiveButtonClass)})),fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){i(e),b.textContent=e.name,q.textContent=e.about,C.src=e.avatar})),fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.sort((function(e,t){return t.createdAt-e.createdAt})).forEach((function(e){return m(e,D)}))})).catch((function(e){console.log(e)})),k.addEventListener("click",(function(){return function(e,t,n,o,r){B.reset(),t.value=o.textContent,n.value=r.textContent,c(e)}(S,E,L,b,q)})),B.addEventListener("submit",(function(){!function(e,t,n,o,c){var u,s,l=B.querySelector(O);l.textContent="Сохранение...",(u=t.value,s=n.value,fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers,method:"PATCH",body:JSON.stringify({name:u,about:s})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(a){i(a),o.textContent=t.value,c.textContent=n.value,r(e),l.textContent="Сохранить"})).catch((function(e){console.log(e)})),o.textContent=t.value,c.textContent=n.value,r(e)}(S,E,L,b,q)})),P.addEventListener("click",(function(){return c(g)})),w.addEventListener("submit",(function(){var e,t,n,o,c,u,i,s;e=g,t=w,n=D,o=x.value,c=j.value,(s=w.querySelector(O)).textContent="Сохранение...",(u=o,i=c,fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers,method:"POST",body:JSON.stringify({name:u,link:i})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(o){r(e),s.textContent="Сохранить",t.reset(),m(o,n)})).catch((function(e){console.log(e)}))})),A.addEventListener("click",(function(){return e=U,B.reset(),void c(e);var e})),N.addEventListener("submit",(function(){!function(e,t,n){var o=N.querySelector(O);o.textContent="Сохранение...",function(e){return fetch("".concat(a.baseUrl,"/users/me/avatar"),{headers:a.headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(n){i(n),t.src=n.avatar,r(e),o.textContent="Сохранить"})).catch((function(e){console.log(e)}))}(U,C,T.value)}))})();