(()=>{"use strict";var t="popup_opened";function e(e){if("Escape"===e.key){var o=document.querySelector(".".concat(t));n(o)}}var n=function(n){n.classList.remove(t),document.body.removeEventListener("keydown",e)},o=function(n){n.classList.add(t),document.body.addEventListener("keydown",e)},r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-15",headers:{authorization:"3701fab1-1ed4-4420-a3e5-6e9ed2eab0d1","Content-Type":"application/json"}},c=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},a={name:"",about:"",avatar:"",_id:"",cohort:""},i=function(t){a=t},u=function(t){return a._id===t._id},l="place__like-button_active",s=document.querySelector(".popup_content_image"),d=s.querySelector(".popup__image-caption"),p=s.querySelector(".popup__image"),f=document.querySelector("#create_place"),_=function(t,e){var n=function(t){var e=f.content.querySelector(".place").cloneNode(!0);e.querySelector(".place__name").textContent=t.name;var n=e.querySelector(".place__image");n.src=t.link,n.alt=t.name,n.addEventListener("click",(function(){!function(t,e,n){e.src=t.src,e.alt=t.alt,d.textContent=t.alt,o(n)}(n,p,s)}));var a=e.querySelector(".place__remove-button");u(t.owner)&&a.classList.add("place__remove-button_visible"),a.addEventListener("click",(function(){var n;(n=t._id,fetch("".concat(r.baseUrl,"/cards/").concat(n),{headers:r.headers,method:"DELETE"}).then(c)).then((function(t){console.log(t),function(t){t.remove()}(e)})).catch((function(t){console.log(t)}))}));var i=e.querySelector(".place__like-button");t.likes.some((function(t){return u(t)}))&&i.classList.add(l);var _=e.querySelector(".place__like-count");return _.textContent=t.likes.length,i.addEventListener("click",(function(){var e=i.classList.contains(l);(function(t,e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{headers:r.headers,method:e?"DELETE":"PUT"}).then(c)})(t._id,e).then((function(t){!function(t){t.classList.toggle(l)}(i),_.textContent=t.likes.length})).catch((function(t){console.log(t)}))})),e}(t);e.prepend(n)},m=function(t,e,n,o){t.classList.remove(n),t.textContent="",e.classList.remove(o)},v=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n)):(e.disabled=!0,e.classList.add(n))},y=function(t,e,n,o,r,c){e.forEach((function(e){var n=t.querySelector(".".concat(e.id,"-error"));m(n,e,o,r)})),setTimeout((function(){v(e,n,c)}),0)};function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var b,S,q=document.querySelector(".popup_content_profile"),E=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),C=document.querySelector(".profile__avatar"),g=q.querySelector(".popup__input_data_name"),k=q.querySelector(".popup__input_data_description"),x=document.querySelector(".profile__edit-button"),A=document.querySelector(".popup_content_place"),w=A.querySelector(".popup__input_data_name"),U=A.querySelector(".popup__input_data_description"),T=document.querySelector(".profile__add-button"),P=document.querySelector(".profile__avatar-container"),j=document.querySelector(".popup_content_avatar"),O=j.querySelector(".popup__input_data_description"),D=document.forms.newPlace,B=document.forms.profileEdit,M=document.forms.avatarEdit,N=document.querySelector(".places__list");b="popup",document.querySelectorAll(".".concat(b)).forEach((function(t){return t.addEventListener("mousedown",(function(e){(e.target.classList.contains(b)||e.target.classList.contains("popup__close-button"))&&n(t)}))})),S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(S.formSelector)).forEach((function(t){var e=Array.from(t.querySelectorAll(S.inputSelector)),n=t.querySelector(S.submitButtonSelector);!function(t,e,n,o,r,c){e.addEventListener("submit",(function(t){t.preventDefault()})),e.addEventListener("reset",(function(a){y(e,t,n,o,r,c)})),t.forEach((function(a){a.addEventListener("input",(function(){!function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?m(r,e,n,o):function(t,e,n,o,r){t.textContent=n,t.classList.add(o),e.classList.add(r)}(r,e,e.validationMessage,n,o)}(e,a,o,r),v(t,n,c)}))})),v(t,n,c)}(e,t,n,S.errorClass,S.inputErrorClass,S.inactiveButtonClass)})),Promise.all([fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then(c),fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then(c)]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c=[],a=!0,i=!1;try{for(n=n.call(t);!(a=(o=n.next()).done)&&(c.push(o.value),!e||c.length!==e);a=!0);}catch(t){i=!0,r=t}finally{try{a||null==n.return||n.return()}finally{if(i)throw r}}return c}}(e,n)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];!function(t){i(t),E.textContent=t.name,L.textContent=t.about,C.src=t.avatar}(r),function(t){t.sort((function(t,e){return new Date(t.createdAt)<new Date(e.createdAt)?-1:1})).forEach((function(t){return _(t,N)}))}(c)})).catch((function(t){console.log(t)})),x.addEventListener("click",(function(){return function(t,e,n,r,c){B.reset(),e.value=r.textContent,n.value=c.textContent,o(t)}(q,g,k,E,L)})),B.addEventListener("submit",(function(t){!function(t,e,o,a,u,l){var s,d;l.textContent="Сохранение...",(s=e.value,d=o.value,fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers,method:"PATCH",body:JSON.stringify({name:s,about:d})}).then(c)).then((function(r){i(r),a.textContent=e.value,u.textContent=o.value,n(t)})).catch((function(t){console.log(t)})).finally((function(){l.textContent="Сохранить"}))}(q,g,k,E,L,t.submitter)})),T.addEventListener("click",(function(){return o(A)})),D.addEventListener("submit",(function(t){var e,o,a,i,u,l,s,d;e=A,o=D,a=N,i=w.value,u=U.value,(l=t.submitter).textContent="Сохранение...",(s=i,d=u,fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers,method:"POST",body:JSON.stringify({name:s,link:d})}).then(c)).then((function(t){n(e),o.reset(),_(t,a)})).catch((function(t){console.log(t)})).finally((function(){l.textContent="Сохранить"}))})),P.addEventListener("click",(function(){return t=j,M.reset(),void o(t);var t})),M.addEventListener("submit",(function(t){!function(t,e,o,a){a.textContent="Сохранение...",function(t){return fetch("".concat(r.baseUrl,"/users/me/avatar"),{headers:r.headers,method:"PATCH",body:JSON.stringify({avatar:t})}).then(c)}(o).then((function(o){i(o),e.src=o.avatar,n(t)})).catch((function(t){console.log(t)})).finally((function(){a.textContent="Сохранить"}))}(j,C,O.value,t.submitter)}))})();